#contentContainer
  %section{:id => "content"}
    %article{:class => "textpage blogpost"}
      - content_for :page_title do
        = @blogpost.title
      %h1
        = @blogpost.title
      .blogboxIntro
        = format(@blogpost.content)
      .blogboxInfo
        .date
          = @blogpost.created_at
        .comments
          = link_to pluralize(@blogpost.blogpost_comments.count, "Comment"), blogpost_path(@blogpost, :anchor => "blogcommentsContainer")
        .tags
          - sort_tags(@blogpost.tags).each do |tag|
            = link_to ["#", tag], blogtag_path(tag)
        .flattrthis
          = link_to image_tag("/images/flattr-badge-large.png"), @blogpost, {:title => @blogpost.title, :rel => "Privacy: The first click will load the flattr-button. So you have to click twice."}


      #blogcommentsContainer
        %h2
          Comments
        - if @blogpost.blogpost_comments.empty?
          %h3
            No comments yet. :(
        - @blogpost.blogpost_comments.each do |comment|
          - unless comment.created_at.nil?
            .blogcommentBox{:id => "comment-" + comment.id.to_s()}
              .commentAuthorImage
                = image_tag gravatar_url(comment.email)
              .commentboxRight
                .commentInfo
                  .commentAuthor
                    = comment.author
                  .commentDate
                    = link_to comment.created_at, {:anchor => "comment-" + comment.id.to_s()}
                .commentContent
                  = comment_format(comment.content)


      #blogcommentform
        %h2
          New Comment
        .blogcommentForm
          = form_for([@blogpost, @blogpost_comment], :url => blogpost_blogpost_comments_path(@blogpost, @blogpost_comment, :anchor => "blogcommentform")) do |f|
            - if @blogpost_comment.errors.any?
              %p
                Something went wrong:
              %ul
                - @blogpost_comment.errors.each do |field, error|
                  %li
                    = error
            = f.label :author, "Your name"
            = f.text_field :author

            = f.label :email, "Your email-address. I'll store it secret, trust me."
            = f.text_field :email

            = f.label :content, "Your comment"
            = f.text_area :content

            = f.label :antispam, "What's the name of the big, grey animal living in Africa? (Spam protection ;))"
            = f.text_field :antispam
            = f.hidden_field :correct_antispam, :value => "Donkey"

            = f.submit "Submit"
